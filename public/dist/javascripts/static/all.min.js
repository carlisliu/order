define("static/category/category",["jquery"],function(t,e,n){function r(t){t&&(this.container=t="string"==typeof t?o(t):t,this.name=t.find("#category-name").val(),this.memo=t.find("#category-memo").val())}var o=t("jquery");r.prototype={save:function(t){var e={name:this.name,memo:this.memo};return o.post("/category/add.html",{category:e}).done(function(e){t(null,e)}).fail(function(e){t(e)}),this},remove:function(t,e){return t?o.post("/category/remove.html",{id:t}).done(function(t){e(null,t)}).fail(function(t){e(t)}):e(new Error("Category's id is empty.")),this},clear:function(){return this.container&&(this.container.find('input[type="text"]').val(""),this.id=this.name=this.memo=null,this.clearStyle()),this},clearStyle:function(){return this.container&&this.container.find(".control-group").removeClass("error success"),this}},n.exports=r}),define("static/category/event",["validate","jgrowl","../common/modal","../utils/index","./category","../common/options"],function(t,e,n){var r=t("jquery"),o=t("../common/options");t("validate"),t("jgrowl");var i=t("../common/modal"),a=t("../utils/index");r.validator.setDefaults({onsubmit:!1}),r(function(){var e=t("./category");r("#save-category").click(function(t){t.preventDefault();var n=r(".validate");if(n.validate(o),n.valid()){var i=new e("#category-form");i.save(function(e,n){n?(i.clear(),r.jGrowl(n.msg||"Saved.")):r.jGrowl(t.toString())})}}),r("#customers-holder").delegate("tbody a","click",function(t){t.preventDefault();var n,s,c=new i("#info-modal"),d=r(this),l={},u=r.trim;l.id=(s=d.parents("tr")).attr("data-category-id"),d.hasClass("deleteRow")?c.setTitle("Warning").setBody("<p>Remove this category will also delete all the products under this category, do you wanna proceed?</p>").bindFooter("danger",function(){(new e).remove(l.id,function(t,e){t||s.remove(),r.jGrowl(t?t.toString():e.msg)})}):(l.name=u(s.find("td:first-child").attr("data-category-name")),l.memo=u(s.find("td:nth-child(2)").attr("data-category-memo")),n=u(r("#category-form-template").html()),c.setTitle("Change Category Info").setBody(a.template(n,l)).bindFooter("confirm",function(t){var e,n=t.find(".validate");return n.validate(o),n.valid()?(e={_id:l.id,name:u(n.find("#category-name").val()),memo:u(n.find("#category-memo").val())},r.post("/category/update.html",{category:e}).done(function(t){"success"===t.status&&(s.find("td:first-child").attr("data-category-name",e.name),s.find("td:first-child").html(e.name),s.find("td:nth-child(2)").attr("data-category-memo",e.memo),s.find("td:nth-child(2)").html(e.memo)),r.jGrowl(t.msg)}).fail(function(t){r.jGrowl(t.toString())}),!0):!1}))})})}),define("static/common/base",["jquery","../utils/index"],function(t,e,n){function r(){}function o(t){var e;t=t||{},("object"!=typeof t||(e=t instanceof i))&&(t={container:e?t:i(t)}),t=i.extend(s,t),this.container=t.container||i(document.body),"string"==typeof this.container&&(this.container=i(this.container)),this.onerror=t.onerror,this.data={}}var i=t("jquery"),a=t("../utils/index"),s={onerror:function(t){a.error("error occurs, %o",t)}};n.exports=o,o.prototype={collectData:function(){var t=this;return this.container.find("input[type=text], input[type=password], input[type=checkbox], input[type=hidden], select, textarea").each(function(){var e=i(this),n=e.attr("data-property");n&&("checkbox"===this.type?t.data[n]=e.is(":checked"):t.data[n]=i.trim(e.val()))}),this},getData:function(){return this.data},post:function(t,e,n,o){var s,c=this;return"boolean"!=typeof t&&(o=n,n=e,e=t,t=!1),"function"==typeof n&&(o=n,n=null),s=t?i.extend({},n||{}):i.extend({},this.collectData().getData(),n||{}),a.debug("url:%s, post data: %o",e,s),this.fixData&&!t&&(s=this.fixData(s),a.debug("url:%s, fixed data: %o",e,s)),i.post(e,s).done(function(t){o(t)}).fail(function(t){(c.onerror||r).call(this,t)}),this}}}),define("static/common/modal",["jquery"],function(t,e,n){function r(t){this.container=o(t)}var o=t("jquery");r.prototype={constructor:r,setTitle:function(t){return t&&this.container.find(".modal-header h3").html(t),this},setBody:function(t){return t&&this.container.find(".modal-body").html(t),this},bindFooter:function(t,e){var n,r=this.container.find(".modal-footer a"),i=this;return n=o(r[1]),"confirm"===t?n.removeClass("btn-danger").addClass("btn-primary"):n.removeClass("btn-primary").addClass("btn-danger"),n.off("click"),n.on("click",function(){var t=o.proxy(e||function(){},this,i.container)();t===!1?n.attr("data-cancel-close","true"):n.attr("data-cancel-close","false")}),this}},n.exports=r}),define("static/common/options",["jquery"],function(t,e,n){var r=t("jquery");n.exports={errorPlacement:function(t,e){e.parents(".controls").append(t)},highlight:function(t){r(t).closest(".control-group").removeClass("error success").addClass("error")},success:function(t){t.addClass("valid").closest(".control-group").removeClass("error success").addClass("success")}}}),define(function(t,e,n){var r=t("jquery"),o={pageSize:10};r.fn.extend({pagination:function(t){var e=r.extend({},o,t),n=(e.currentPage||1,e.pageSize),i=e.totolSize||0;return n>=i?this:void 0}})}),define("static/common/pipe-form",["jquery","../utils/index"],function(t,e,n){function r(t){return t instanceof a?t:a(t)}function o(t){return"string"==typeof t?a.trim(t):a.trim(t.html())}function i(t){this.options=a.extend({},c,t),this.container=r(t.container),this._set={},this.form=null}var a=t("jquery"),s=t("../utils/index"),c={collections:{}};i.prototype={pull:function(t){t=t||a.parseJSON(this.container.find("input[data-entity=entity]").val());var e=this._set,n=this.options;return e.entity=t||{},this.container.find("[data-type]").each(function(){var t=a(this),r=t.attr("data-type");if(r){var o=t.attr("data-property");e.special=e.special||{},e.special[o]={key:o,type:r,collections:n.collections[o]||(t.attr("data-collections")?a.parseJSON(t.attr("data-collections")):null)}}}),this},pipe:function(t){t=s.template(o(t),this._set.entity),t=r(t);var e=this._set.special;if(e)for(var n in e)if("select"===e[n].type){var i=t.find("select[data-property="+n+"]");s.bindSelector(i,e[n].collections||{},this._set.entity[n])}else"checkbox"===e[n].type&&t.find("input[type=checkbox][data-property="+n+"]").attr("checked",this._set.entity[n]);return this.form=t,this},html:function(){return this.form?a.trim(this.form.html()):""}},n.exports=i}),define("static/control/control",["jquery","jgrowl"],function(t,e,n){function r(t){this.record=t,this.loading="/images/loading.gif",this.finished="/images/action_check.png"}var o=t("jquery");t("jgrowl"),r.prototype={constructor:r,before:function(){if(this.record){var t=o.isArray(this.record)?this.record:[this.record],e=this;o.each(t,function(t,n){o(n).find("td:last").html(e.render(e.loading))})}return this},finish:function(){if(this.record){var t=o.isArray(this.record)?this.record:[this.record],e=this;o.each(t,function(t,n){o(n).find("td:last").html(e.render(e.finished))})}return this},error:function(t){if(this.record){var e=o.isArray(this.record)?this.record:[this.record];o.each(e,function(e,n){o(n).find("td:last").html(""),o.jGrowl(t||"Error")})}return this},render:function(t){return'<img src="'+t+'" />'},"import":function(t,e){var n=this;this.before(),o.post("/control/table.html",t,function(t){"success"===t.status?n.finish():n.error(t.message),e(t)}).fail(function(t){n.error(t.message)})}},n.exports=r}),define("static/control/event",["jquery","./control","jgrowl","../common/options","validate"],function(t,e,n){var r=t("jquery"),o=t("./control");t("validate"),t("jgrowl");var i=t("../common/options");r(function(){r(document.body).on("click","#tables-holder th input[type=checkbox]",function(t){var e=r(this);e.is(":checked")?e.parents("table").find("tbody input[type=checkbox]").prop("checked",!0):e.parents("table").find("tbody input[type=checkbox]").prop("checked",!1)}).on("click","#tables-holder td input[type=checkbox]",function(t){var e=r(this),n=!0;e.is(":checked")?("Product"===e.attr("data-table")&&e.parents("tr").siblings().find("input[type=checkbox][data-table=Category]").prop("checked",!0),e.parents("tr").siblings().find("input[type=checkbox]").each(function(){return r(this).is(":checked")?void 0:n=!1})):("Category"===e.attr("data-table")&&e.parents("tr").siblings().find("input[type=checkbox][data-table=Product]").prop("checked",!1),n=!1),e.parents("table").find("thead input[type=checkbox]").prop("checked",n)}).on("click","button",function(t){var e=r(".validate");if(e.validate(i),e.valid()){var n=r("#source").val(),a=r("#destination").val();if(n===a)return r.jGrowl("Source and destination can not be identical.");var s={};r("#tables-holder").find("tbody tr").filter(function(){return r(this).find("input[type=checkbox]").is(":checked")}).each(function(){var t=r(this),e=t.attr("data-table");s[e]={table:e,target:t}});var c;s.Category&&s.Product&&(c=new o([s.Category.target,s.Product.target]),c["import"]({table:["Category","Product"],source:n,destination:a},function(t){}),delete s.Category,delete s.Product);for(var d in s)c=new o(s[d].target),c["import"]({table:s[d].table,source:n,destination:a},function(t){})}})})}),define("static/company/company",["jquery"],function(t,e,n){function r(t){this.container=t}var o=t("jquery");r.prototype={saveOrUpdate:function(t,e){return o.post("/company/save.html",{company:t}).done(function(t){e(null,t)}).fail(function(t){e(t)}),this},clear:function(){return this.container&&this.container.find("text").val(""),this},setData:function(t){var e=this.container;return t&&(e.find("#company-name").val(t.name||""),e.find("#company-address").val(t.address||""),e.find("#company-phone").val(t.phone||"")),this}},o(function(){var t=new r(o("#settings-form"));o("#company-setting").click(function(e){e.preventDefault(),o.getJSON("/company/get.html",function(e){e&&e.company?t.setData(e.company):t.clear()})}),o("#setting-confirm").click(function(e){e.preventDefault();var n=t.container,r={name:n.find("#company-name").val(),address:n.find("#company-address").val(),phone:n.find("#company-phone").val()};t.saveOrUpdate(r,function(){})}),"1"===o("#_company_missing_flag").val()&&o("#company-setting").click()}),n.exports=r}),define("static/customer/customer",["jquery","../utils/index"],function(t,e,n){function r(t){var e;this.container=t="string"==typeof t?o(t):t,(e=t.find("#customer-id")).length&&(this.id=e.val()),this.name=t.find("#customer-name").val(),this.tel=t.find("#customer-tel").val(),this.address={street:t.find("#customer-addr-street").val(),city:t.find("#customer-addr-city").val(),country:t.find("#customer-addr-country").val()}}var o=t("jquery"),i=t("../utils/index");r.fn=r.prototype={save:function(t){var e={};return e.name=this.name,e.tel=this.tel,e.address=this.address,o.post("/customer/add.html",{customer:e}).done(function(e){o.isFunction(t)&&t(null,e)}).fail(function(e){o.isFunction(t)&&t(e)}),this},clear:function(){return this.container&&(this.container.find('input[type="text"]').val(""),this.id=this.name=this.tel=this.address=null,this.clearStyle()),this},clearStyle:function(){return this.container&&this.container.find(".control-group").removeClass("error success"),this},getCustomerById:function(t,e){return t?o.getJSON("/customer/details/"+t).done(function(t){e(t.customer)}).fail(function(t){e(null)}):e(null),this},setData:function(t){var e=this.container;return e.find("#customer-id").val(this.id=t.id),e.find("#customer-name").val(this.name=t.name),e.find("#customer-tel").val(this.tel=t.tel),this.address=this.address||{},e.find("#customer-addr-street").val(this.address.street=t.address.street),e.find("#customer-addr-city").val(this.address.city=t.address.city),e.find("#customer-addr-country").val(this.address.country=t.address.country),e.find('input[type="text"]').trigger("blur"),this}},r.Display=function(t){this.container="string"==typeof t?o(t):t,this.template=o.trim(o("#customer-row-template").html())},r.Display.fn=r.Display.prototype={add:function(t){return this.render(t),this},remove:function(t,e){var n=this;return e=o.isFunction(e)?e:function(){},t?o.post("/customer/remove.html",{id:t}).done(function(r){n.container.find('tbody tr[data-customer-id="'+t+'"]').remove(),e(null,r)}).fail(e):e(new Error("Customer's ID is empty, can not delete.")),this},render:function(t){t["fix-address"]=function(t,e){var n;return e=e||", ",n=t.street+e+t.city,t.country&&(n+=e+t.country),n}(t.address);var e=i.template(this.template,t);return this.container.find("tbody").prepend(e),this},collectData:function(t,e){var n,r={},i=o.trim;return e?r.id=i(t.attr(e)):(n=t.find("td"),o.each(["name","tel","address"],function(t,e){var i=o(n[inex]).attr("data-customer-"+e);i&&(r[e]=JSON.parse(i))})),r}},n.exports=r}),define("static/customer/event",["validate","validate.extend","jgrowl","./customer","../utils/index","../common/modal"],function(t){var e=t("jquery");e(function(){var n,r,o,i,a,s={errorPlacement:function(t,e){e.parents(".controls").append(t)},highlight:function(t){e(t).closest(".control-group").removeClass("error success").addClass("error")},success:function(t){t.addClass("valid").closest(".control-group").removeClass("error success").addClass("success")}};t("validate"),t("validate.extend"),t("jgrowl"),a=t("../utils/index"),n=t("./customer"),r=n.Display,i=t("../common/modal"),e.validator.setDefaults({onsubmit:!1}),o=new r("#customers-holder"),o.container.delegate("tbody tr td a","click",function(t){t.preventDefault();var n,r,c,d=new i("#info-modal"),l=e(this),u=e.trim;if(l.hasClass("deleteRow"))d.setTitle("Warning").setBody("<p>Do you wanna remove this customer?</p>").bindFooter("danger",function(){o.remove(l.parents("tr").attr("data-customer-id"),function(t,n){e.jGrowl(t?t.toString():n.msg)})});else{n=u(e("#customer-form-template").html()),r=l.parents("tr"),c=u(r.find("td:nth-child(3)").attr("data-customer-address"));try{c=JSON.parse(c)}catch(t){c=new Function("return "+c),c=c()||{}}var f={id:u(r.attr("data-customer-id")),name:u(r.find("td:first-child").attr("data-customer-name")),tel:u(r.find("td:nth-child(2)").attr("data-customer-tel")),"address.street":c.street,"address.city":c.city,"address.country":c.country};d.setTitle("Change Customer Info").setBody(a.template(n,f)).bindFooter("confirm",function(t){var n,o=t.find(".validate");return o.validate(s),o.valid()?(n={},n.id=f.id,n.name=u(o.find("#customer-name").val()),n.tel=u(o.find("#customer-tel").val()),n.address={street:u(o.find("#customer-addr-street").val()),city:u(o.find("#customer-addr-city").val()),country:u(o.find("#customer-addr-country").val())},e.post("/customer/update.html",{customer:n}).done(function(t){if("success"===t.status){r.find("td:nth-child(1)").attr("data-customer-name",n.name),r.find("td:nth-child(1)").html(n.name),r.find("td:nth-child(2)").attr("data-customer-tel",n.tel),r.find("td:nth-child(2)").html(n.tel),r.find("td:nth-child(3)").attr("data-customer-address",JSON.stringify(n.address));var o=n.address;r.find("td:nth-child(3)").html(o.street+","+o.city+(o.country?","+o.country:""))}e.jGrowl(t.msg)}).fail(function(t){e.jGrowl(t.toString())}),!0):!1})}}),e("#save-customer").click(function(t){t.preventDefault();var r,i=e(".validate");i.validate(s),i.valid()&&(r=new n("#customer-form"),r.save(function(t,n){var i=t?"Error occurs":n.msg;t||"success"!==n.msg?r.clearStyle():(r.clear(),o.render(n.customer)),e.jGrowl(i)}))})})}),define("static/menu/index",["jquery"],function(t){var e=t("jquery");e(".main-nav > li.active > a").click(function(t){e(window).width()<=767&&(t.preventDefault(),e(this).hasClass("open")&&!e(this).hasClass("toggle-collapsed")?(e(this).removeClass("open"),e(this).parents(".main-nav").find("li").each(function(){e(this).find(".collapsed-nav").addClass("closed"),e(this).hide()}),e(this).parent().show(),e(this).parent().removeClass("open")):(e(this).hasClass("toggle-collapsed")&&e(this).parent().addClass("open"),e(this).hasClass("open")?(e(this).parents(".main-nav").find("li").not(".active").each(function(){e(this).find(".collapsed-nav").addClass("closed"),e(this).hide()}),e(this).removeClass("open")):(e(this).addClass("open"),e(this).parents(".main-nav").find("li").show())))}),e(".toggle-collapsed").each(function(){e(this).hasClass("on-hover")?(e(this).click(function(t){t.preventDefault()}),e(this).parent().hover(function(){e(this).addClass("open"),e(this).find(".collapsed-nav").slideDown(),e(this).find("img").attr("src","/images/toggle-subnav-up-white.png")},function(){e(this).removeClass("open"),e(this).find(".collapsed-nav").slideUp(),e(this).find("img").attr("src","/images/toggle-subnav-down.png")})):e(this).click(function(t){t.preventDefault(),e(this).parent().find(".collapsed-nav").is(":visible")?(e(this).parent().removeClass("open"),e(this).parent().find(".collapsed-nav").slideUp(),e(this).find("img").attr("src","/images/toggle-subnav-down.png")):(e(this).parent().addClass("open"),e(this).parent().find(".collapsed-nav").slideDown(),e(this).find("img").attr("src","/images/toggle-subnav-up-white.png"))})}),e(".collapsed-nav li a").hover(function(){e(this).parent().hasClass("active")||e(this).stop().animate({marginLeft:"5px"},300)},function(){e(this).stop().animate({marginLeft:"0"},100)}),e(document.body).on("keyup","#find-order",function(t){var n;13==t.keyCode&&(n=e.trim(e(this).val()),/^\d+$/.test(n)?window.location.href="/order/list.html?no="+n:Date.parse&&Date.parse(n)?window.location.href="/order/list.html?date="+n:alert("Wrong format of search condition"))})}),define("static/order/event",["jquery","validate","validate.extend","jgrowl","./order","../customer/customer","../product/product","../utils/index"],function(t){var e=t("jquery"),n=t("./order").Order,r=t("./order").Detail,o=t("../customer/customer"),i=new o("#customer-form"),a=t("../product/product"),s=new a,c=t("../utils/index"),d={},l={errorPlacement:function(t,e){e.parents(".controls").append(t)},highlight:function(t){e(t).closest(".control-group").removeClass("error success").addClass("error")},success:function(t){t.addClass("valid").closest(".control-group").removeClass("error success").addClass("success")}};t("jgrowl"),t("validate"),t("validate.extend"),e.validator.setDefaults({onsubmit:!1}),e(function(){function t(t){var n=0;return e.each(t,function(t,e){n+=e.product_price*e.product_qty}),n.toFixed(2)}function o(){var t=e("#product-form");return t.validate(l),t.valid()}function a(){var t=e("#customer-form");return t.validate(l),t.valid()}var u,f,p,m,h,v;e("#customer-id").change(function(){var t=e(this).val();return t?void i.getCustomerById(e(this).val(),function(t){t&&i.setData(t)}):(i.clear(),this)}),u=e("#category-id"),f=e("#product-id"),p=e("#product-qty-actions"),m=e("#product-price"),h=e("#product-qty"),v=e("#order-detail-holder"),u.change(function(){var t=u.val();t&&s.getProductByCategoryId(t,function(t,n){var r,o=t||n.msg||"";o&&e.jGrowl(o),(r=n.products)&&(f.data("productsData",r),c.bindSelector(f,c.convert(r,"_id","name")),f.trigger("change"))})}),f.change(function(){var t,n=f.val();m.val(""),n&&(t=f.data("productsData"),e.each(t,function(t,e){return n===e._id?(m.val(e.price),!1):void 0}))}),p.delegate("span","click",function(){var t=e.trim;return function(n){var r=e(this),o=t(r.attr("data-action")),i=parseInt(h.val()||0);switch(o){case"add":h.val(++i);break;case"minus":h.val(0>=i?0:--i)}}}()),v.delegate("a.deleteRow","click",function(n){n.preventDefault();var r=e(this).parents("tr");delete d[r.attr("order-detail-id")],v.find("tbody tr:last").find("td:nth-child(5)").html(t(d)),r.remove()}),e("#add-to-order").click(function(n){n.preventDefault();var i,a,s,l,p,y=e(this);if(o()){i=y.data("template"),i||(i=e.trim(e("#product-detail-template").html()),y.data("template",i)),s=parseFloat(m.val()),l=parseFloat(h.val());var g={category_id:u.val(),category_name:u.find("option:selected").text(),product_id:f.val(),product_name:f.find("option:selected").text(),product_price:s,product_qty:l,total:(l*s).toFixed(2)};p=new r(g),d[p.gid]=p,a=e(c.template(i,g)),a.attr("order-detail-id",p.gid),v.find("tbody").prepend(a),v.find("tbody tr:last").find("td:nth-child(5)").html(t(d))}}),e("#save-order").click(function(t){var r,o=function(t){var n=[];return e.each(t,function(t,e){n.push(e.getData())}),n};t.preventDefault(),a()&&(e.isEmptyObject(d)?e.jGrowl("Please select at least one product"):(r=new n({customer_id:i.id,customer_name:i.name,customer_tel:i.tel,customer_address:i.address},o(d)),r.save(r.getData(),function(t,n){t?e.jGrowl(t.toString()):e.jGrowl("Saved.")})))}),e("#clear-order").click(function(t){t.preventDefault(),d={},v.find("tbody tr:last").find("td:nth-child(5)").html(0),v.find('tbody tr[data-total!="total"]').remove()})})}),define("static/order/list",["jquery","../utils/index","datepicker"],function(t){var e=t("jquery"),n=t("../utils/index");t("datepicker"),e(function(){var t=e("#order-customer"),r=e("#order-date"),o=e("#order-no"),i=e("#order-search");e.getJSON("/customer/get.html",function(e){e&&e.customer&&n.bindSelector(t,e.customer)}),r.datepicker();var a=e.trim(e("#order-result-template").html()),s=e("#order-detail-holder");i.click(function(i){i.preventDefault();var c,d={},l=e.trim;c=l(t.val()),c&&(d.customer_id=c),c=l(r.val()),c&&(d.create_at=c),c=l(o.val()),c&&(d.no=c),e.getJSON("/order/get.html",{params:d},function(t){s.find("tbody").empty(),t&&t.orders&&t.orders.length?e.each(t.orders,function(t,e){var r=n.template(a,e);s.find("tbody").append(r)}):s.find("tbody").append('<tr><td colspan="5">No matching records found</td></tr>')})}),e("#order-detail-holder").find("tbody").delegate("tr a","click",function(t){t.preventDefault(),window.open("/order/details/"+e(this).attr("data-order-no"))}),location.search||i.trigger("click")})}),define("static/order/order",["jquery"],function(t,e,n){function r(t){t&&(this.gid=r.guid++,this.category_id=t.category_id||"",this.category_name=t.category_name||"",this.product_id=t.product_id||"",this.product_name=t.product_name||"",this.product_price=t.product_price||"",this.product_qty=t.product_qty||0)}function o(t,e){this.customer=t,this.details=e}var i=t("jquery");r.guid=0,r.prototype={constructor:r,getData:function(){return{category_id:this.category_id,category_name:this.category_name,product_id:this.product_id,product_name:this.product_name,product_price:this.product_price,product_qty:this.product_qty}}},o.prototype={save:function(t,e){return t?i.post("/order/add.html",{order:t}).done(function(t){e(null,t.order)}).fail(function(t){e(t)}):e(new Error("Order is empty.")),this},getData:function(){var t=this.customer||{};return{customer_id:t.customer_id,customer_name:t.customer_name,customer_tel:t.customer_tel,customer_address:t.customer_address,details:this.details}},getTotal:function(){var t=0;return i.each(this.details,function(e,n){t+=parseFloat(n.product_price)}),t},addDetail:function(t){var e;return t instanceof r?(e=t,(this.details||(this.details=[])).push(e)):(e=new r(t),(this.details||(this.details=[])).push(new r(e))),e.gid},removeDetail:function(t){var e=this;return t&&i.each(e.details,function(n,r){return r.gid===t?(e.details.splice(n),!1):void 0}),this}},n.exports={Order:o,Detail:r}}),define("static/product/event",["validate","validate.extend","jgrowl","../common/modal","../utils/index","./product","../common/options"],function(t){var e=t("jquery"),n=t("../common/options");t("validate"),t("validate.extend"),t("jgrowl");var r=t("./product"),o=t("../common/modal"),i=t("../utils/index"),a=window.msg;a&&"null"!==a&&(e.jGrowl(a),a=null),e.validator.setDefaults({onsubmit:!1}),e(function(){e("#save-product").click(function(t){t.preventDefault();var o=e(".validate");if(o.validate(n),o.valid()){var i=new r("#product-form");i.save(function(n,r){r?(i.clear(),e.jGrowl(r.msg||"Saved.")):e.jGrowl(t.toString())})}}),e("#products-holder").delegate("tbody a","click",function(t){t.preventDefault();var a,s,c=new o("#info-modal"),d=e(this),l={},u=e.trim;l.id=(s=d.parents("tr")).attr("data-product-id"),d.hasClass("deleteRow")?c.setTitle("Warning").setBody("<p>Do you wanna remove this product?</p>").bindFooter("danger",function(){(new r).remove(l.id,function(t,n){t||s.remove(),e.jGrowl(t?t.toString():n.msg)})}):(l.name=u(s.find("td:first-child").attr("data-product-name")),l.category_id=u(s.find("td:nth-child(2)").attr("data-product-category")),l.price=u(s.find("td:nth-child(3)").attr("data-product-price")),l.memo=u(s.find("td:nth-child(4)").attr("data-product-memo")),a=u(e("#product-form-template").html()),a=e(i.template(a,l)),i.bindSelector(a.find("#product-category"),JSON.parse(u(e("#category-data").html()))),c.setTitle("Change Category Info").setBody(a.html()).bindFooter("confirm",function(t){var r,o=t.find(".validate");return o.validate(n),o.valid()?(r={id:l.id,name:u(o.find("#product-name").val()),category_id:u(o.find("#product-category").val()),price:parseFloat(u(o.find("#product-price").val())),memo:u(o.find("#product-memo").val())},e.post("/product/update.html",{product:r}).done(function(t){if("success"===t.status){var n=t.product;s.find("td:first-child").attr("data-product-name",n.name),s.find("td:first-child").html(n.name),s.find("td:nth-child(2)").attr("data-product-category",n.category_id),s.find("td:nth-child(2)").html(n.category_name),s.find("td:nth-child(3)").attr("data-product-price",n.price),s.find("td:nth-child(3)").html(n.price),s.find("td:nth-child(4)").attr("data-product-memo",n.memo),s.find("td:nth-child(4)").html(n.memo)}e.jGrowl(t.msg)}).fail(function(t){e.jGrowl(t.toString())}),!0):!1}),c.container.find("#product-category").val(l.category_id))})})}),define("static/product/product",["jquery"],function(t,e,n){function r(t){t&&(this.container=t="string"==typeof t?o(t):t,this.name=t.find("#product-name").val(),this.price=t.find("#product-price").val(),this.category_id=t.find("#product-category").val(),this.memo=t.find("#product-memo").val())}var o=t("jquery");r.prototype={save:function(t){var e={name:this.name,price:this.price,category_id:this.category_id,memo:this.memo};return o.post("/product/add.html",{product:e}).done(function(e){t(null,e)}).fail(function(e){t(e)}),this},getProductByCategoryId:function(t,e){o.getJSON("/product/find.html/"+t).done(function(t){e(null,t)}).fail(function(t){e(t)})},remove:function(t,e){return t?o.post("/product/remove.html",{id:t}).done(function(t){e(null,t)}).fail(function(t){e(t)}):e(new Error("Product's id is empty.")),this},clear:function(){return this.container&&(this.container.find('input[type="text"],select').val(""),this.id=this.name=this.memo=this.category_id=null,this.clearStyle()),this},clearStyle:function(){return this.container&&this.container.find(".control-group").removeClass("error success"),this}},n.exports=r}),define("static/users/event",["jquery","validate","jgrowl","./user","../common/options","../common/modal","../common/pipe-form"],function(t){function e(){var t=n(".dataTables_info"),e=s.exec(t.text())[1];e=parseInt(e),!isNaN(e)&&e>0&&(--e,e>1?t.text(e+" entries"):t.text(e+" entry"))}var n=t("jquery"),r=t("./user");t("validate"),t("jgrowl");var o=t("../common/options"),i=t("../common/modal"),a=t("../common/pipe-form"),s=/(\d+)/;n.validator.setDefaults({onsubmit:!1}),n(function(){var t=new r("#user-form");n(document.body).on("click","#save-user",function(e){e.preventDefault();var r=n(".validate");r.validate(o),r.valid()&&t.post("/users/add.html",function(e){"success"==e.status&&t.clearInput(),n.jGrowl(e.message||"Saved.")})}).on("click","table#users-holder a.deleteRow",function(r){r.preventDefault();var o=n(this),a=new i("#info-modal");a.setTitle("Warning").setBody("<p>Do you wanna remove this user?</p>").bindFooter("danger",function(){t.remove(o.attr("data-user-id"),function(t){return"success"===t.status?(o.parents("tr").remove(),e(),n.jGrowl(t.message||"Removed.")):void n.jGrowl(t.message||"Error.")})})}).on("click","table#users-holder a.updateRow",function(t){var e=n(this);t.preventDefault();var s=new a({container:e.parents("tr"),collections:{company_id:n.parseJSON(n.trim(n("#company-dataset").val()))}});s.pull().pipe(n("#update-form"));var c=(s.form,new i("#info-modal"));c.setTitle("Change User Info").setBody(s.html()).bindFooter("confirm",function(t){if(t=t.find(".validate"),t.validate(o),t.valid()){var e=new r(t);return e.collectData(),e.post("/users/update.html",function(t){console.log(t),n.jGrowl(t.message||"Saved.")}),!0}return!1})})})}),define("static/users/user",["jquery","../utils/index","../common/base"],function(t,e,n){function r(t){a.call(this,t)}var o=t("jquery"),i=t("../utils/index"),a=t("../common/base");i.inherits(r,a),r.prototype.fixData=function(t){return{user:t}},r.prototype.remove=function(t,e){return this.post(!0,"/users/remove.html",{id:t},e),this},r.prototype.clearInput=function(){return this.container&&this.container.find("input[type=text], input[type=password], input[type=checkbox], select, textarea").each(function(){"checkbox"===this.type?o(this).attr("checked",!1):o(this).val("")}),this},n.exports=r}),define("static/utils/index",["jquery"],function(t){function e(t){return function(){window.console&&console[t].apply(console,arguments)}}var n=t("jquery");return{template:function(t,e){return t.replace(/\{(\w+.?\w+)\}/g,function(t,n){var r="object"==typeof e[n]?JSON.stringify(e[n]):e[n];return r||""}).replace(/\{(\d+)\}/g,function(t,n){var r="object"==typeof e[n]?JSON.stringify(e[n]):e[n];return r||""})},bindSelector:function(t,e,n){if(t.empty(),e){var r;r=n?'<option value="">Choose One</option>':'<option value="" selected="selected">Choose One</option>';for(var o in e)r+=n===o?'<option value="'+o+'" selected="selected">'+e[o]+"</option>":'<option value="'+o+'">'+e[o]+"</option>";t.append(r)}return t},convert:function(t,e,r){var o={};return n.isArray(t)&&n.each(t,function(t,n){o[n[e]]=n[r]}),o},log:e("log"),debug:e("debug"),error:e("error"),inherits:function(t,e){if(null==t)throw new TypeError("The constructor to `inherits` must not be null or undefined.");if(null==e)throw new TypeError("The super constructor to `inherits` must not be null or undefined.");if(null==e.prototype)throw new TypeError("The constructor to `inherits` must have a prototype.");Object.setPrototypeOf||(Object.setPrototypeOf=function(t,e){for(var n in e.prototype)t.prototype[n]=e.prototype[n]}),Object.setPrototypeOf(t.prototype,e.prototype)}}});