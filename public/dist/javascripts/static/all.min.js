define("static/category/category",function(t,e,r){function n(t){t&&(this.container=t="string"==typeof t?o(t):t,this.name=t.find("#category-name").val(),this.memo=t.find("#category-memo").val())}var o=t("jquery");n.prototype={save:function(t){var e={name:this.name,memo:this.memo};return o.post("/category/add.html",{category:e}).done(function(e){t(null,e)}).fail(function(e){t(e)}),this},remove:function(t,e){return t?o.post("/category/remove.html",{id:t}).done(function(t){e(null,t)}).fail(function(t){e(t)}):e(new Error("Category's id is empty.")),this},clear:function(){return this.container&&(this.container.find('input[type="text"]').val(""),this.id=this.name=this.memo=null,this.clearStyle()),this},clearStyle:function(){return this.container&&this.container.find(".control-group").removeClass("error success"),this}},r.exports=n}),define("static/category/event",["validate","jgrowl"],function(t,e,r){var n=t("jquery"),o={errorPlacement:function(t,e){e.parents(".controls").append(t)},highlight:function(t){n(t).closest(".control-group").removeClass("error success").addClass("error")},success:function(t){t.addClass("valid").closest(".control-group").removeClass("error success").addClass("success")}};t("validate"),t("jgrowl");var a=t("../common/modal"),i=t("../utils/index");n.validator.setDefaults({onsubmit:!1}),n(function(){var e=t("./category");n("#save-category").click(function(t){t.preventDefault();var r=n(".validate");if(r.validate(o),r.valid()){var a=new e("#category-form");a.save(function(e,r){r?(a.clear(),n.jGrowl(r.msg||"Saved.")):n.jGrowl(t.toString())})}}),n("#customers-holder").delegate("tbody a","click",function(t){t.preventDefault();var r,d,c=new a("#info-modal"),s=n(this),l={},u=n.trim;l.id=(d=s.parents("tr")).attr("data-category-id"),s.hasClass("deleteRow")?c.setTitle("Warning").setBody("<p>Remove this category will also delete all the products under this category, do you wanna proceed?</p>").bindFooter("danger",function(){(new e).remove(l.id,function(t,e){t||d.remove(),n.jGrowl(t?t.toString():e.msg)})}):(l.name=u(d.find("td:first-child").attr("data-category-name")),l.memo=u(d.find("td:nth-child(2)").attr("data-category-memo")),r=u(n("#category-form-template").html()),c.setTitle("Change Category Info").setBody(i.template(r,l)).bindFooter("confirm",function(t){var e,r=t.find(".validate");return r.validate(o),r.valid()?(e={id:l.id,name:u(r.find("#category-name").val()),memo:u(r.find("#category-memo").val())},n.post("/category/update.html",{category:e}).done(function(t){d.find("td:first-child").attr("data-category-name",e.name),d.find("td:first-child").html(e.name),d.find("td:nth-child(2)").attr("data-category-memo",e.memo),d.find("td:nth-child(2)").html(e.memo),n.jGrowl(t.msg)}).fail(function(t){n.jGrowl(t.toString())}),!0):!1}))})})}),define("static/common/base",function(t,e,r){function n(){}function o(t){var e;t=t||{},("object"!=typeof t||(e=t instanceof a))&&(t={container:e?t:a(t)}),t=a.extend(d,t),this.container=t.container||a(document.body),this.onerror=t.onerror,this.data={}}var a=t("jquery"),i=t("../utils/index"),d={onerror:function(t){i.error("error occurs, %j",t)}};r.exports=o,o.prototype={collectData:function(){var t=this;return this.container.find("input").each(function(){var e=a(this),r=e.attr("data-property");r&&(t.data[r]=a.trim(e.val()))}),this},getData:function(){return this.data},post:function(t,e,r,o){var d,c=this;return"boolean"!=typeof t&&(o=r,r=e,e=t,t=!1),"function"==typeof r&&(o=r,r=null),d=t?a.extend({},r||{}):a.extend({},this.collectData().getData(),r||{}),i.debug("url:%s, post data: %j",e,d),this.fixData&&(d=this.fixData(d),i.debug("url:%s, fixed data: %j",e,d)),a.post(e,d).done(function(t){o(t)}).fail(function(t){(c.onerror||n).call(this,t)}),this}}}),define("static/common/modal",function(t,e,r){function n(t){this.container=o(t)}var o=t("jquery");n.prototype={constructor:n,setTitle:function(t){return t&&this.container.find(".modal-header h3").html(t),this},setBody:function(t){return t&&this.container.find(".modal-body").html(t),this},bindFooter:function(t,e){var r,n=this.container.find(".modal-footer a"),a=this;return r=o(n[1]),"confirm"===t?r.removeClass("btn-danger").addClass("btn-primary"):r.removeClass("btn-primary").addClass("btn-danger"),r.off("click"),r.on("click",function(){var t=o.proxy(e||function(){},this,a.container)();t===!1?r.attr("data-cancel-close","true"):r.attr("data-cancel-close","false")}),this}},r.exports=n}),define(function(t,e,r){var n=t("jquery"),o={pageSize:10};n.fn.extend({pagination:function(t){var e=n.extend({},o,t),r=(e.currentPage||1,e.pageSize),a=e.totolSize||0;return r>=a?this:void 0}})}),define("static/company/company",function(t,e,r){function n(t){this.container=t}var o=t("jquery");n.prototype={saveOrUpdate:function(t,e){return o.post("/company/save.html",{company:t}).done(function(t){e(null,t)}).fail(function(t){e(t)}),this},clear:function(){return this.container&&this.container.find("text").val(""),this},setData:function(t){var e=this.container;return t&&(e.find("#company-name").val(t.name||""),e.find("#company-address").val(t.address||""),e.find("#company-phone").val(t.phone||"")),this}};var a=new n(o("#settings-form"));o("#company-setting").click(function(t){t.preventDefault(),o.getJSON("/company/get.html",function(t){t&&t.company?a.setData(t.company):a.clear()})}),o("#setting-confirm").click(function(t){t.preventDefault();var e=a.container,r={name:e.find("#company-name").val(),address:e.find("#company-address").val(),phone:e.find("#company-phone").val()};a.saveOrUpdate(r,function(){})}),r.exports=n}),define("static/customer/customer",function(t,e,r){function n(t){var e;this.container=t="string"==typeof t?o(t):t,(e=t.find("#customer-id")).length&&(this.id=e.val()),this.name=t.find("#customer-name").val(),this.tel=t.find("#customer-tel").val(),this.address={street:t.find("#customer-addr-street").val(),city:t.find("#customer-addr-city").val(),country:t.find("#customer-addr-country").val()}}var o=t("jquery"),a=t("../utils/index");n.fn=n.prototype={save:function(t){var e={};return e.name=this.name,e.tel=this.tel,e.address=this.address,o.post("/customer/add.html",{customer:e}).done(function(e){o.isFunction(t)&&t(null,e)}).fail(function(e){o.isFunction(t)&&t(e)}),this},clear:function(){return this.container&&(this.container.find('input[type="text"]').val(""),this.id=this.name=this.tel=this.address=null,this.clearStyle()),this},clearStyle:function(){return this.container&&this.container.find(".control-group").removeClass("error success"),this},getCustomerById:function(t,e){return t?o.getJSON("/customer/details/"+t).done(function(t){e(t.customer)}).fail(function(t){e(null)}):e(null),this},setData:function(t){var e=this.container;return e.find("#customer-id").val(this.id=t.id),e.find("#customer-name").val(this.name=t.name),e.find("#customer-tel").val(this.tel=t.tel),this.address=this.address||{},e.find("#customer-addr-street").val(this.address.street=t.address.street),e.find("#customer-addr-city").val(this.address.city=t.address.city),e.find("#customer-addr-country").val(this.address.country=t.address.country),e.find('input[type="text"]').trigger("blur"),this}},n.Display=function(t){this.container="string"==typeof t?o(t):t,this.template=o.trim(o("#customer-row-template").html())},n.Display.fn=n.Display.prototype={add:function(t){return this.render(t),this},remove:function(t,e){var r=this;return e=o.isFunction(e)?e:function(){},t?o.post("/customer/remove.html",{id:t}).done(function(n){r.container.find('tbody tr[data-customer-id="'+t+'"]').remove(),e(null,n)}).fail(e):e(new Error("Customer's ID is empty, can not delete.")),this},render:function(t){t["fix-address"]=function(t,e){var r;return e=e||", ",r=t.street+e+t.city,t.country&&(r+=e+t.country),r}(t.address);var e=a.template(this.template,t);return this.container.find("tbody").prepend(e),this},collectData:function(t,e){var r,n={},a=o.trim;return e?n.id=a(t.attr(e)):(r=t.find("td"),o.each(["name","tel","address"],function(t,e){var a=o(r[inex]).attr("data-customer-"+e);a&&(n[e]=JSON.parse(a))})),n}},r.exports=n}),define("static/customer/event",["validate","validate.extend","jgrowl"],function(t){var e=t("jquery");e(function(){var r,n,o,a,i,d={errorPlacement:function(t,e){e.parents(".controls").append(t)},highlight:function(t){e(t).closest(".control-group").removeClass("error success").addClass("error")},success:function(t){t.addClass("valid").closest(".control-group").removeClass("error success").addClass("success")}};t("validate"),t("validate.extend"),t("jgrowl"),i=t("../utils/index"),r=t("./customer"),n=r.Display,a=t("../common/modal"),e.validator.setDefaults({onsubmit:!1}),o=new n("#customers-holder"),o.container.delegate("tbody tr td a","click",function(t){t.preventDefault();var r,n,c,s=new a("#info-modal"),l=e(this),u=e.trim;if(l.hasClass("deleteRow"))s.setTitle("Warning").setBody("<p>Do you wanna remove this customer?</p>").bindFooter("danger",function(){o.remove(l.parents("tr").attr("data-customer-id"),function(t,r){e.jGrowl(t?t.toString():r.msg)})});else{r=u(e("#customer-form-template").html()),n=l.parents("tr"),c=u(n.find("td:nth-child(3)").attr("data-customer-address"));try{c=JSON.parse(c)}catch(t){c=new Function("return "+c),c=c()||{}}var f={id:u(n.attr("data-customer-id")),name:u(n.find("td:first-child").attr("data-customer-name")),tel:u(n.find("td:nth-child(2)").attr("data-customer-tel")),"address.street":c.street,"address.city":c.city,"address.country":c.country};s.setTitle("Change Customer Info").setBody(i.template(r,f)).bindFooter("confirm",function(t){var r,o=t.find(".validate");return o.validate(d),o.valid()?(r={},r.id=f.id,r.name=u(o.find("#customer-name").val()),r.tel=u(o.find("#customer-tel").val()),r.address={street:u(o.find("#customer-addr-street").val()),city:u(o.find("#customer-addr-city").val()),country:u(o.find("#customer-addr-country").val())},e.post("/customer/update.html",{customer:r}).done(function(t){if("success"===t.status){n.find("td:nth-child(1)").attr("data-customer-name",r.name),n.find("td:nth-child(1)").html(r.name),n.find("td:nth-child(2)").attr("data-customer-tel",r.tel),n.find("td:nth-child(2)").html(r.tel),n.find("td:nth-child(3)").attr("data-customer-address",JSON.stringify(r.address));var o=r.address;n.find("td:nth-child(3)").html(o.street+","+o.city+(o.country?","+o.country:""))}e.jGrowl(t.msg)}).fail(function(t){e.jGrowl(t.toString())}),!0):!1})}}),e("#save-customer").click(function(t){t.preventDefault();var n,a=e(".validate");a.validate(d),a.valid()&&(n=new r("#customer-form"),n.save(function(t,r){var a=t?"Error occurs":r.msg;t||"success"!==r.msg?n.clearStyle():(n.clear(),o.render(r.customer)),e.jGrowl(a)}))})})}),define("static/order/event",["validate","validate.extend","jgrowl"],function(t){var e=t("jquery"),r=t("./order").Order,n=t("./order").Detail,o=t("../customer/customer"),a=new o("#customer-form"),i=t("../product/product"),d=new i,c=t("../utils/index"),s={},l={errorPlacement:function(t,e){e.parents(".controls").append(t)},highlight:function(t){e(t).closest(".control-group").removeClass("error success").addClass("error")},success:function(t){t.addClass("valid").closest(".control-group").removeClass("error success").addClass("success")}};t("jgrowl"),t("validate"),t("validate.extend"),e.validator.setDefaults({onsubmit:!1}),e(function(){function t(t){var r=0;return e.each(t,function(t,e){r+=e.product_price*e.product_qty}),r.toFixed(2)}function o(){var t=e("#product-form");return t.validate(l),t.valid()}function i(){var t=e("#customer-form");return t.validate(l),t.valid()}var u,f,m,p,h,v;e("#customer-id").change(function(){var t=e(this).val();return t?void a.getCustomerById(e(this).val(),function(t){t&&a.setData(t)}):(a.clear(),this)}),u=e("#category-id"),f=e("#product-id"),m=e("#product-qty-actions"),p=e("#product-price"),h=e("#product-qty"),v=e("#order-detail-holder"),u.change(function(){var t=u.val();t&&d.getProductByCategoryId(t,function(t,r){var n,o=t||r.msg||"";o&&e.jGrowl(o),(n=r.products)&&(f.data("productsData",n),c.bindSelector(f,c.convert(n,"id","name")),f.trigger("change"))})}),f.change(function(){var t,r=f.val();p.val(""),r&&(t=f.data("productsData"),e.each(t,function(t,e){return r===e.id?(p.val(e.price),!1):void 0}))}),m.delegate("span","click",function(){var t=e.trim;return function(r){var n=e(this),o=t(n.attr("data-action")),a=parseInt(h.val()||0);switch(o){case"add":h.val(++a);break;case"minus":h.val(0>=a?0:--a)}}}()),v.delegate("a.deleteRow","click",function(r){r.preventDefault();var n=e(this).parents("tr");delete s[n.attr("order-detail-id")],v.find("tbody tr:last").find("td:nth-child(5)").html(t(s)),n.remove()}),e("#add-to-order").click(function(r){r.preventDefault();var a,i,d,l,m,y=e(this);if(o()){a=y.data("template"),a||(a=e.trim(e("#product-detail-template").html()),y.data("template",a)),d=parseFloat(p.val()),l=parseFloat(h.val());var g={category_id:u.val(),category_name:u.find("option:selected").text(),product_id:f.val(),product_name:f.find("option:selected").text(),product_price:d,product_qty:l,total:(l*d).toFixed(2)};m=new n(g),s[m.gid]=m,i=e(c.template(a,g)),i.attr("order-detail-id",m.gid),v.find("tbody").prepend(i),v.find("tbody tr:last").find("td:nth-child(5)").html(t(s))}}),e("#save-order").click(function(t){var n,o=function(t){var r=[];return e.each(t,function(t,e){r.push(e.getData())}),r};t.preventDefault(),i()&&(e.isEmptyObject(s)?e.jGrowl("Please select at least one product"):(n=new r({customer_id:a.id,customer_name:a.name,customer_tel:a.tel,customer_address:a.address},o(s)),n.save(n.getData(),function(t,r){t?e.jGrowl(t.toString()):e.jGrowl("Saved.")})))}),e("#clear-order").click(function(t){t.preventDefault(),s={},v.find("tbody tr:last").find("td:nth-child(5)").html(0),v.find('tbody tr[data-total!="total"]').remove()})})}),define("static/order/list",["datepicker"],function(t){var e=t("jquery"),r=t("../utils/index");t("datepicker"),e(function(){var t=e("#order-customer"),n=e("#order-date"),o=e("#order-no"),a=e("#order-search");e.getJSON("/customer/get.html",function(e){e&&e.customer&&r.bindSelector(t,e.customer)}),n.datepicker();var i=e.trim(e("#order-result-template").html()),d=e("#order-detail-holder");a.click(function(a){a.preventDefault();var c,s={},l=e.trim;c=l(t.val()),c&&(s.customer_id=c),c=l(n.val()),c&&(s.create_at=c),c=l(o.val()),c&&(s.no=c),e.getJSON("/order/get.html",{params:s},function(t){d.find("tbody").empty(),t&&t.orders&&t.orders.length?e.each(t.orders,function(t,e){var n=r.template(i,e);d.find("tbody").append(n)}):d.find("tbody").append('<tr><td colspan="5">No matching records found</td></tr>')})}),e("#order-detail-holder").find("tbody").delegate("tr a","click",function(t){t.preventDefault(),window.open("/order/details/"+e(this).attr("data-order-no"))}),a.trigger("click")})}),define("static/order/order",function(t,e,r){function n(t){t&&(this.gid=n.guid++,this.category_id=t.category_id||"",this.category_name=t.category_name||"",this.product_id=t.product_id||"",this.product_name=t.product_name||"",this.product_price=t.product_price||"",this.product_qty=t.product_qty||0)}function o(t,e){this.customer=t,this.details=e}var a=t("jquery");n.guid=0,n.prototype={constructor:n,getData:function(){return{category_id:this.category_id,category_name:this.category_name,product_id:this.product_id,product_name:this.product_name,product_price:this.product_price,product_qty:this.product_qty}}},o.prototype={save:function(t,e){return t?a.post("/order/add.html",{order:t}).done(function(t){e(null,t.order)}).fail(function(t){e(t)}):e(new Error("Order is empty.")),this},getData:function(){var t=this.customer||{};return{customer_id:t.customer_id,customer_name:t.customer_name,customer_tel:t.customer_tel,customer_address:t.customer_address,details:this.details}},getTotal:function(){var t=0;return a.each(this.details,function(e,r){t+=parseFloat(r.product_price)}),t},addDetail:function(t){var e;return t instanceof n?(e=t,(this.details||(this.details=[])).push(e)):(e=new n(t),(this.details||(this.details=[])).push(new n(e))),e.gid},removeDetail:function(t){var e=this;return t&&a.each(e.details,function(r,n){return n.gid===t?(e.details.splice(r),!1):void 0}),this}},r.exports={Order:o,Detail:n}}),define("static/product/event",["validate","validate.extend","jgrowl"],function(t){var e,r,n=t("jquery"),o=window.msg,a=t("./product"),i={errorPlacement:function(t,e){e.parents(".controls").append(t)},highlight:function(t){n(t).closest(".control-group").removeClass("error success").addClass("error")},success:function(t){t.addClass("valid").closest(".control-group").removeClass("error success").addClass("success")}};t("validate"),t("validate.extend"),t("jgrowl"),e=t("../common/modal"),r=t("../utils/index"),o&&"null"!==o&&(n.jGrowl(o),o=null),n.validator.setDefaults({onsubmit:!1}),n(function(){n("#save-product").click(function(t){t.preventDefault();var e=n(".validate");if(e.validate(i),e.valid()){var r=new a("#product-form");r.save(function(e,o){o?(r.clear(),n.jGrowl(o.msg||"Saved.")):n.jGrowl(t.toString())})}}),n("#products-holder").delegate("tbody a","click",function(t){t.preventDefault();var o,d,c=new e("#info-modal"),s=n(this),l={},u=n.trim;l.id=(d=s.parents("tr")).attr("data-product-id"),s.hasClass("deleteRow")?c.setTitle("Warning").setBody("<p>Do you wanna remove this product?</p>").bindFooter("danger",function(){(new a).remove(l.id,function(t,e){t||d.remove(),n.jGrowl(t?t.toString():e.msg)})}):(l.name=u(d.find("td:first-child").attr("data-product-name")),l.category_id=u(d.find("td:nth-child(2)").attr("data-product-category")),l.price=u(d.find("td:nth-child(3)").attr("data-product-price")),l.memo=u(d.find("td:nth-child(4)").attr("data-product-memo")),o=u(n("#product-form-template").html()),o=n(r.template(o,l)),r.bindSelector(o.find("#product-category"),JSON.parse(u(n("#category-data").html()))),c.setTitle("Change Category Info").setBody(o.html()).bindFooter("confirm",function(t){var e,r=t.find(".validate");return r.validate(i),r.valid()?(e={id:l.id,name:u(r.find("#product-name").val()),category_id:u(r.find("#product-category").val()),price:parseFloat(u(r.find("#product-price").val())),memo:u(r.find("#product-memo").val())},n.post("/product/update.html",{product:e}).done(function(t){var e=t.product;d.find("td:first-child").attr("data-product-name",e.name),d.find("td:first-child").html(e.name),d.find("td:nth-child(2)").attr("data-product-category",e.category_id),d.find("td:nth-child(2)").html(e.category_name),d.find("td:nth-child(3)").attr("data-product-price",e.price),d.find("td:nth-child(3)").html(e.price),d.find("td:nth-child(4)").attr("data-product-memo",e.memo),d.find("td:nth-child(4)").html(e.memo),n.jGrowl(t.msg)}).fail(function(t){n.jGrowl(t.toString())}),!0):!1}),c.container.find("#product-category").val(l.category_id))})})}),define("static/product/product",function(t,e,r){function n(t){t&&(this.container=t="string"==typeof t?o(t):t,this.name=t.find("#product-name").val(),this.price=t.find("#product-price").val(),this.category_id=t.find("#product-category").val(),this.memo=t.find("#product-memo").val())}var o=t("jquery");n.prototype={save:function(t){var e={name:this.name,price:this.price,category_id:this.category_id,memo:this.memo};return o.post("/product/add.html",{product:e}).done(function(e){t(null,e)}).fail(function(e){t(e)}),this},getProductByCategoryId:function(t,e){o.getJSON("/product/find.html/"+t).done(function(t){e(null,t)}).fail(function(t){e(t)})},remove:function(t,e){return t?o.post("/product/remove.html",{id:t}).done(function(t){e(null,t)}).fail(function(t){e(t)}):e(new Error("Product's id is empty.")),this},clear:function(){return this.container&&(this.container.find('input[type="text"],select').val(""),this.id=this.name=this.memo=this.category_id=null,this.clearStyle()),this},clearStyle:function(){return this.container&&this.container.find(".control-group").removeClass("error success"),this}},r.exports=n}),define("static/utils/index",function(t){function e(t){return function(e){window.console&&console[t].apply(console,arguments)}}var r=t("jquery");return{template:function(t,e){return t.replace(/\{(\w+.?\w+)\}/g,function(t,r){var n="object"==typeof e[r]?JSON.stringify(e[r]):e[r];return n||""}).replace(/\{(\d+)\}/g,function(t,r){var n="object"==typeof e[r]?JSON.stringify(e[r]):e[r];return n||""})},bindSelector:function(t,e){if(t.empty(),e){var r='<option value="" selected="selected">Choose One</option>';for(var n in e)r+='<option value="'+n+'">'+e[n]+"</option>";t.append(r)}return t},convert:function(t,e,n){var o={};return r.isArray(t)&&r.each(t,function(t,r){o[r[e]]=r[n]}),o},log:e("log"),debug:e("debug")}});